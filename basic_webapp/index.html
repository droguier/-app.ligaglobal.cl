<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión - Sistema de Gestión</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <!-- Google OAuth Library -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1>Sistema de Gestión</h1>
                <p>Inicie sesión para acceder al sistema</p>
            </div>
            
            <div class="login-form">
                <!-- Mensajes de error o éxito -->
                <div id="message" class="message hidden"></div>
                
                <!-- Botón de inicio de sesión con Google -->
                <!-- Google Login para entorno DEV (app.ligaglobal.cl) -->
                <div id="g_id_onload"
                    data-client_id="407435070764-eh72qg5h8beqo3soifru2uheepqhh2hi.apps.googleusercontent.com"
                    data-callback="handleCredentialResponse"
                    data-auto_prompt="false"
                    data-login_uri="http://app.ligaglobal.cl/auth/google/callback">
                </div>
                <div class="g_id_signin"
                     data-type="standard"
                     data-size="large"
                     data-theme="outline"
                     data-text="signin_with"
                     data-shape="rectangular"
                     data-logo_alignment="left">
                </div>
                <!-- Fin Google Login DEV -->
                
                <!-- Separador -->
                <div class="separator">
                    <span>o</span>
                </div>
                
                <!-- Formulario alternativo (opcional) -->
                <form id="loginForm" class="hidden">
                    <div class="form-group">
                        <label for="email">Correo electrónico</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Contraseña</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    
                    <button type="submit" class="btn-primary">Iniciar Sesión</button>
                </form>
                
                <!-- Enlace para mostrar formulario alternativo -->
                <div class="form-toggle">
                    <a href="#" id="toggleForm">¿Prefiere iniciar sesión con correo y contraseña?</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Incluir el script de autenticación simulada -->
    <script src="assets/js/auth.js"></script>
    <script>
        // Toggle para formulario alternativo
        document.getElementById('toggleForm').addEventListener('click', function(e) {
            e.preventDefault();
            const form = document.getElementById('loginForm');
            form.classList.toggle('hidden');
            
            // Cambiar texto del enlace
            if (form.classList.contains('hidden')) {
                this.textContent = '¿Prefiere iniciar sesión con correo y contraseña?';
            } else {
                this.textContent = '¿Prefiere iniciar sesión con Google?';
            }
        });
        
        // Manejo del formulario alternativo (simulado)
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Obtener valores del formulario
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Simular autenticación
            // En una implementación real, aquí se haría la verificación con el servidor
            // Por ahora, simularemos un inicio de sesión exitoso
            
            // Verificar si el usuario existe en nuestro "sistema"
            let users = JSON.parse(localStorage.getItem('users')) || [];
            let user = users.find(u => u.email === email);
            
            // Si el usuario no existe, crear uno nuevo con rol de operador por defecto
            if (!user) {
                user = {
                    id: users.length + 1,
                    email: email,
                    name: email.split('@')[0], // Usar la parte antes del @ como nombre
                    role: 'operador' // Por defecto, los nuevos usuarios son operadores
                };
                users.push(user);
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // Mostrar mensaje de éxito
            showMessage('Inicio de sesión exitoso. Redirigiendo...', 'success');
            
            // Iniciar sesión del usuario después de un breve retraso
            setTimeout(() => {
                loginUser(user);
            }, 1000);
        });
    </script>
</body>
</html>